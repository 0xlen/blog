<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.3 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>[AWS][EKS] Best practice for load balancing - 1. Let’s start with an example from Kubernetes document - Continuous Improvement</title>
<meta name="description" content="This article is sharing the best practice for doing load balancing on Amazon EKS, learn what is advantage and disadvantage of using different controller. We will discuss more detail about what is the problem of using default Kubernetes service deployment as mentioned on official document.">


  <meta name="author" content="Yang-Xin Cao (Eason Cao)">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Continuous Improvement">
<meta property="og:title" content="[AWS][EKS] Best practice for load balancing - 1. Let’s start with an example from Kubernetes document">
<meta property="og:url" content="https://easoncao.com/eks-best-practice-load-balancing-1-en/">


  <meta property="og:description" content="This article is sharing the best practice for doing load balancing on Amazon EKS, learn what is advantage and disadvantage of using different controller. We will discuss more detail about what is the problem of using default Kubernetes service deployment as mentioned on official document.">



  <meta property="og:image" content="https://easoncao.com/assets/images/posts/2022/04/eks-best-practice-load-balancing/instance-target.png">





  <meta property="article:published_time" content="2022-04-08T00:00:00-05:00">





  

  


<link rel="canonical" href="https://easoncao.com/eks-best-practice-load-balancing-1-en/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Continuous Improvement",
      "url": "https://easoncao.com/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Continuous Improvement Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- Google adsense -->
<script data-ad-client="ca-pub-1852752964062281" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<link rel="shortcut icon" type="image/jpg" href="/assets/apple-touch-icon.png"/>

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/apple-touch-icon.png" alt=""></a>
        
        <a class="site-title" href="/">
          Continuous Improvement
          <span class="site-subtitle"></span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/posts/">所有文章 All Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/courses/">學習資源 Learning</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">關於 About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="https://www.gravatar.com/avatar/0d33994eec9eddc67415e07a7fcafc9d?s=200" alt="Yang-Xin Cao (Eason Cao)" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Yang-Xin Cao (Eason Cao)</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Engineer@Amazon <br />- <a href="https://www.awshof.com/allstarscertifiedlist.html">AWS All-5 certified</a> / ECS &amp; EKS SME / Marathon Runner / PADI Open Water Diver</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Amazon / Dublin, Ireland</span>
        </li>
      

      
        
          
            <li><a href="mailto:eason@easoncao.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://linkedin.com/in/easoncao" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-id-badge" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
        
          
            <li><a href="https://facebook.com/EasonTechTalk" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i><span class="label">Facebook</span></a></li>
          
        
          
            <li><a href="https://github.com/0xlen" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="[AWS][EKS] Best practice for load balancing - 1. Let’s start with an example from Kubernetes document">
    <meta itemprop="description" content="This article is sharing the best practice for doing load balancing on Amazon EKS, learn what is advantage and disadvantage of using different controller. We will discuss more detail about what is the problem of using default Kubernetes service deployment as mentioned on official document.">
    <meta itemprop="datePublished" content="2022-04-08T00:00:00-05:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">[AWS][EKS] Best practice for load balancing - 1. Let’s start with an example from Kubernetes document
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  7 minute read

</p>
          
        </header>
      

      <!-- Google ads in article -->
      <div>
          <ins class="adsbygoogle"
               style="display:block; text-align:center;"
               data-ad-layout="in-article"
               data-ad-format="fluid"
               data-ad-client="ca-pub-1852752964062281"
               data-ad-slot="8435469231"></ins>
          <script>
               (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
      </div>
      <hr>

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-cog"></i> Table of Contents</h4></header>
              <ul class="toc__menu">
  <li><a href="#understand-the-default-kubernetes-load-balancing">Understand the default Kubernetes load balancing</a>
    <ul>
      <li><a href="#an-overview-of-externaltrafficpolicy">An overview of externalTrafficPolicy</a></li>
      <li><a href="#deep-dive-into-the-load-balancing-behavior---an-example-from-k8s-document">Deep dive into the load balancing behavior - An example from K8s document</a>
        <ul>
          <li><a href="#case-1">Case 1</a></li>
          <li><a href="#case-2">Case 2</a></li>
        </ul>
      </li>
      <li><a href="#the-reason-why-you-will-see-your-targets-are-failing-the-health-check-even-pods-are-running">The reason why you will see your targets are failing the health check even Pods are running</a></li>
      <li><a href="#whats-wrong-with-externaltrafficpolicy">What’s wrong with externalTrafficPolicy?</a></li>
    </ul>
  </li>
  <li><a href="#summary">Summary</a></li>
  <li><a href="#references">References</a></li>
</ul>

            </nav>
          </aside>
        
        <p>This article is sharing the best practice for doing load balancing on Amazon EKS, learn what is advantage and disadvantage of using different controller. We will discuss more detail about what is the problem of using default Kubernetes service deployment as mentioned on official document.</p>

<h2 id="understand-the-default-kubernetes-load-balancing">Understand the default Kubernetes load balancing</h2>

<h3 id="an-overview-of-externaltrafficpolicy">An overview of <code class="language-plaintext highlighter-rouge">externalTrafficPolicy</code></h3>

<p>I have many occurrences to see Kubernetes administrators are not very familiar with the Kubernetes network flow, and feel struggling about that when they need to diagnose networking issue, especially for users using managed Kubernetes cluster service. But I think that’s normal to see this gap because it reflects Kubernetes is doing encapsulation perfectly, causes you are unable to easily troubleshoot any real-world failures unless you had deeply understand its design.</p>

<p>Before walking through the detail about the load balancing, it is required to understand the fundamental knowledge of Kubernetes load balancing and its effect when defining your YAML files.</p>

<p>In the Kubernetes, it provides <a href="https://kubernetes.io/docs/concepts/services-networking/service/#external-traffic-policy">External traffic policy</a>, so you can set this field (<code class="language-plaintext highlighter-rouge">spec.externalTrafficPolicy</code>) in your Kubernetes service deployment to control the flow, and decide how to route the traffic from external. Kubernetes offers two options for this policy: <code class="language-plaintext highlighter-rouge">Cluster</code> and <code class="language-plaintext highlighter-rouge">Local</code>, let’s have a deep overview to see how it works:</p>

<figure class="">
  <img src="/assets/images/posts/2022/04/eks-best-practice-load-balancing/externaltrafficpolicy.png" alt="The overview of ExternalTrafficPolicy" />
  
    <figcaption>
      Figure 1: externalTrafficPolicy

    </figcaption>
  
</figure>

<p>By default, the <code class="language-plaintext highlighter-rouge">kube-proxy</code> is performing this layer of load balancing by using <code class="language-plaintext highlighter-rouge">iptables</code>. Based on the Pods you are running, it will create rules in  your iptables and uses random mode (<code class="language-plaintext highlighter-rouge">--mode random</code>) to perform the load balancing based on the probability. For example, if you have 3 Pods need to be distributed, <code class="language-plaintext highlighter-rouge">kube-proxy</code> will take the responsibility to add required iptables rules with defined probability, and try to balance the load:</p>

<figure class="">
  <img src="/assets/images/posts/2022/04/eks-best-practice-load-balancing/services-iptables-overview.svg" alt="Kubernetes service overview" />
  
    <figcaption>
      Figure 2: Kubernetes service overview (<a href="https://kubernetes.io/docs/concepts/services-networking/service/#proxy-mode-iptables">source</a>)

    </figcaption>
  
</figure>

<p>I am not going to drill down into too much detail as it can increase the complexity of this article, however, if you are interested to learn how this translation happens, you can review the iptables rules on your host to see what’s going on.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># An example of iptables rules
-A KUBE-SVC-XXXXX -m comment --comment "default/app" -m statistic --mode random --probability 0.20000000019 -j KUBE-SEP-AAAAAA
-A KUBE-SVC-XXXXX -m comment --comment "default/app" -m statistic --mode random --probability 0.25000000000 -j KUBE-SEP-BBBBBB
-A KUBE-SVC-XXXXX -m comment --comment "default/app" -m statistic --mode random --probability 0.33332999982 -j KUBE-SEP-CCCCCC
-A KUBE-SVC-XXXXX -m comment --comment "default/app" -m statistic --mode random --probability 0.50000000000 -j KUBE-SEP-DDDDDD
-A KUBE-SVC-XXXXX -m comment --comment "default/app" -j KUBE-SEP-EEEEEE
</code></pre></div></div>

<p>As mentioned in <em>Figure 1</em>, when <code class="language-plaintext highlighter-rouge">externalTrafficPolicy=Cluster</code>, it can have a scenario will route the traffic to other Nodes if you deploy Pod(s) on them. By relying on the iptables rules, this policy can accomplish the load balancing by redirecting them to other Nodes. In theory, this can bring the traffic jump out of the original Node.</p>

<p>When <code class="language-plaintext highlighter-rouge">externalTrafficPolicy=Local</code>, it limits the traffic only can be redirected on the same Node; however, the behavior of doing load balancing through the iptables still happens. If you have multiple Pods running on the single Node, the traffic can be routed to one of them.</p>

<h3 id="deep-dive-into-the-load-balancing-behavior---an-example-from-k8s-document">Deep dive into the load balancing behavior - An example from K8s document</h3>

<p>Let’s see an example mentioned at official Kubernetes document<sup id="fnref:k8s-service-lb" role="doc-noteref"><a href="#fn:k8s-service-lb" class="footnote" rel="footnote">1</a></sup>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion: v1
kind: Service
metadata:
  name: nginx-svc
  labels:
    app: nginx
spec:
  type: LoadBalancer
  ports:
  - port: 80
    protocol: TCP
  selector:
    app: nginx
</code></pre></div></div>

<p>If you use AWS as cloud provider and deploy the service, it generally will create an Elastic Load Balancer (Classic Load Balancer) and provide the traffic load balancing. The Elastic Load Balancer will be managed by the <strong>in-tree load balancer controller</strong><sup id="fnref:k8s-elb-source-code" role="doc-noteref"><a href="#fn:k8s-elb-source-code" class="footnote" rel="footnote">2</a></sup>, which is implemented in Kubernetes source code; hence, you can simply provision the Elastic Load Balancer on AWS seamlessly.</p>

<p>Looks familiar, right? The example above is quite common if you find tutorial on somewhere. Maybe that is exactly same configuration running in your production environment.</p>

<p>But here is the problem: by default, Kubernetes implements another layer of load balancing, which is backed with <code class="language-plaintext highlighter-rouge">kube-proxy</code>. Let’s say if you have two worker nodes (<code class="language-plaintext highlighter-rouge">Node-1</code> and <code class="language-plaintext highlighter-rouge">Node-2</code>), and each node have Pods running on it (<code class="language-plaintext highlighter-rouge">Pod-1</code>, <code class="language-plaintext highlighter-rouge">Pod-2</code> on <code class="language-plaintext highlighter-rouge">Node-1</code>; <code class="language-plaintext highlighter-rouge">Pod-3</code> on <code class="language-plaintext highlighter-rouge">Node-2</code>), using default option (<code class="language-plaintext highlighter-rouge">externalTrafficPolicy=Cluster</code>). On AWS, the traffic flow generally is representing as below:</p>

<h4 id="case-1">Case 1</h4>

<p>The default Kubernetes service will expose your application with a specific service port to provide external accessibility (<code class="language-plaintext highlighter-rouge">NodePort</code>), and establish relevant iptables rules to perform NAT traslation by replacing the IP address of the destination field.</p>

<p>With this design, this can be a happy case if <code class="language-plaintext highlighter-rouge">kube-proxy</code> doesn’t redirect the request to other host, which can be outlined as:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>client -&gt; Load Balancer -&gt; Node-1 (NodePort) -&gt; iptables rules -&gt; Pod-1 on Node-1
</code></pre></div></div>

<h4 id="case-2">Case 2</h4>

<p>However, what if the iptables forward the traffic to other Nodes?</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>client -&gt; Load Balancer -&gt; Node-1 (NodePort) -&gt; iptables rules -&gt; Pod-3 on Node-2 
</code></pre></div></div>

<p>On the other hand, if you deploy a Kubernetes service like this, the traffic flow can be routed as two particular phenomena:</p>

<figure class="">
  <img src="/assets/images/posts/2022/04/eks-best-practice-load-balancing/instance-target.png" alt="The traffic flow when working with externalTrafficPolicy" />
  
    <figcaption>
      Figure 3: The traffic flow when working with externalTrafficPolicy

    </figcaption>
  
</figure>

<p>As you can see, no matter what it is, the behavior seems like doesn’t provide a better route because it definitely increases the number of hops for the traffic flow.</p>

<p>What about <code class="language-plaintext highlighter-rouge">externalTrafficPolicy: Local</code>? Does it work better?</p>

<p>Follow the example as mentioned in the previous paragraph, let’s say if you have two Pods (<code class="language-plaintext highlighter-rouge">Pod-1</code> and <code class="language-plaintext highlighter-rouge">Pod-2</code>) running on the same Node (<code class="language-plaintext highlighter-rouge">Node-1</code>). The traffic flow of this policy generally can be breaking down as below:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>client -&gt; Load Balancer -&gt; Node-1 (NodePort) -&gt; iptables rules -&gt; Node-1 (Target Pod-1)
client -&gt; Load Balancer -&gt; Node-1 (NodePort) -&gt; iptables rules -&gt; Node-1 (Target Pod-2)
</code></pre></div></div>

<p>When load balancer move the request to the backend (<code class="language-plaintext highlighter-rouge">Node-1</code>), the probability to forward the request by iptables rules to the <code class="language-plaintext highlighter-rouge">Pod-1</code> and <code class="language-plaintext highlighter-rouge">Pod-2</code>, <strong>is 50% chances</strong>.</p>

<p>On the other hand, the traffic firstly pass through the Elastic Load Balancer, and do the routing again in the system level (iptables), which means the architecture will perform the load balancing <strong>twice</strong>.</p>

<p>With no doubt, it did not offer the best path for the traffic routing.</p>

<h3 id="the-reason-why-you-will-see-your-targets-are-failing-the-health-check-even-pods-are-running">The reason why you will see your targets are failing the health check even Pods are running</h3>

<p>If <code class="language-plaintext highlighter-rouge">externalTrafficPolicy=Local</code> and you have multiple Nodes running behind your Elastic Load Balancer, you probably will see some Nodes will fail the health check, <strong>which can be expected</strong>.</p>

<p>That’s because if some Node doesn’t run the service’s backend Pods so it cannot pass the health check.</p>

<figure class="">
  <img src="/assets/images/posts/2022/04/eks-best-practice-load-balancing/externalTrafficPolicy-local.png" alt="Some Node doesn't pass health check due to externalTrafficPolicy" />
  
    <figcaption>
      Figure 4: Some Node doesn’t pass health check due to externalTrafficPolicy

    </figcaption>
  
</figure>

<p>In general, it doesn’t impact anything because the ELB will ensure only healthy targets can be routed; however, in this case, it doesn’t perfectly distribute the load with Elastic Load Balancer and offer high availabilty when we have multiple Pods. If the Node down, it can impact all Pods running on it.</p>

<h3 id="whats-wrong-with-externaltrafficpolicy">What’s wrong with externalTrafficPolicy?</h3>

<blockquote>
  <p>So, looks like using <code class="language-plaintext highlighter-rouge">externalTrafficPolicy=Cluster</code> is a good option?</p>
</blockquote>

<p>Imagine you have a long running connection is jumping out of the first Node, unfortunately, the first Node is having issue such as hardware failure, intermittent connectivity problem … etc. In the end, it is going to be down. In this case, if any existing connections forwarded from other Nodes, the connections will be impacted and cannot response back to the origin correctly. In general, the Node down can cause the packet loss because the connection route is established in the middle:</p>

<p><em>(If you have established connection passed the Node, here is an example of the breaking route situation if the <code class="language-plaintext highlighter-rouge">Node-1</code> in the middle is down.)</em></p>
<blockquote>
  <p>client -&gt; Load Balancer -&gt; <del>Node-1 (NodePort)</del> -&gt; iptables rules -&gt; Target Pod-2 on Node-2</p>
</blockquote>

<p>If you reviewed the flow of <em>Figure 3</em>, connections can be routed to different paths and it can be hard to predict once you deployed many Pods. It also increase the complexity if you would like to trace the networking flow during the problem diagnostic.</p>

<p>When having a large scale scenario (e.g. deploy 100, 500 even 10,000 Pods), this also can potentially bring the system level issue, or, result in the packet loss, such as network latency increased due to kernel needs to compare several iptables rules when a new connection comes in; or, reach out to the kernel limits for the networking stack, because Linux kernel needs to track of them when working with iptables, and insert the rules on the system level. One common issue is to fill out the connection tracking table (conntrack) of the Linux kernel when the scale grows.</p>

<h2 id="summary">Summary</h2>

<p>In this article, it explains the behavior of load balancing on Kubernetes. This article also brings you an overview and learn what issue can occur if you follow the default Kubernetes example to deploy your Elastic Load Balancer.</p>

<p>Now we have deep-level understanding of the Kubernetes load balancing, let’s start with more discussion regarding the load imbalancing problem with the current architecture on Amazon EKS in the next article.</p>

<ul>
  <li><a href="/eks-best-practice-load-balancing-1-en">Best practice for load balancing - 1. Let’s start with an example from Kubernetes document</a></li>
  <li><a href="/eks-best-practice-load-balancing-2-en">Best practice for load balancing - 2. imbalanced problem</a></li>
  <li><a href="/eks-best-practice-load-balancing-3-en">Best practice for load balancing - 3. what controller should I use</a></li>
</ul>

<h2 id="references">References</h2>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:k8s-service-lb" role="doc-endnote">
      <p>Kubernetes service - <a href="https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer">Type LoadBalancer</a> <a href="#fnref:k8s-service-lb" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:k8s-elb-source-code" role="doc-endnote">
      <p>Kubernetes source code - <a href="https://github.com/kubernetes/kubernetes/blob/64c5ed380441b4015301cf64a44a698400b03d8b/staging/src/k8s.io/legacy-cloud-providers/aws/aws_loadbalancer.go#L969">aws_loadbalancer.go</a> <a href="#fnref:k8s-elb-source-code" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#alb-ingress-controller" class="page__taxonomy-item" rel="tag">ALB Ingress Controller</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#alb" class="page__taxonomy-item" rel="tag">ALB</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#amazon-web-services" class="page__taxonomy-item" rel="tag">amazon web services</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#amazon" class="page__taxonomy-item" rel="tag">amazon</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#aws-load-balancer-controller" class="page__taxonomy-item" rel="tag">AWS Load Balancer Controller</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#aws" class="page__taxonomy-item" rel="tag">aws</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#ec2" class="page__taxonomy-item" rel="tag">EC2</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#eks" class="page__taxonomy-item" rel="tag">EKS</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#elastic-compute-cloud" class="page__taxonomy-item" rel="tag">Elastic Compute Cloud</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#elastic-kubernetes-service" class="page__taxonomy-item" rel="tag">Elastic Kubernetes Service</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#elastic-load-balancer" class="page__taxonomy-item" rel="tag">Elastic Load Balancer</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#elb" class="page__taxonomy-item" rel="tag">ELB</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#k8s" class="page__taxonomy-item" rel="tag">k8s</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#kubernetes" class="page__taxonomy-item" rel="tag">Kubernetes</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#load-balancer" class="page__taxonomy-item" rel="tag">Load Balancer</a>
    
    </span>
  </p>




        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2022-04-08T00:00:00-05:00">April 8, 2022</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=%5BAWS%5D%5BEKS%5D+Best+practice+for+load+balancing+-+1.+Let%27s+start+with+an+example+from+Kubernetes+document%20https%3A%2F%2Feasoncao.com%2Feks-best-practice-load-balancing-1-en%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Feasoncao.com%2Feks-best-practice-load-balancing-1-en%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Feasoncao.com%2Feks-best-practice-load-balancing-1-en%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
      <iframe
        style="width: 100%; max-width: 485px; height: 170px; margin: auto; overflow: hidden; display: block;"
        src="https://button.like.co/in/embed/easoncao/button?referrer=https%3A%2F%2Feasoncao.com%2Feks-best-practice-load-balancing-1-en%2F" frameBorder="0">
      </iframe>
      

      <!-- Buy me a coffee -->
      <section class="page__share">
        <h4 class="page__share-title">Is that useful? Let me know or buy me a coffee</h4>
        <p class="page__meta">這篇內容對你有幫助嗎？</p>
        <a href="https://paypal.me/e4son"><img src="https://cdn.jsdelivr.net/gh/twolfson/paypal-github-button@1.0.0/dist/button.svg" alt="Support via PayPal"></a>
        <a href="https://p.ecpay.com.tw/17C964C" class="btn btn--success">一次性支持 (ECPay)</a>
      </section>


      
  <nav class="pagination">
    
      <a href="/nex-work/" class="pagination--pager" title="NEX WORK - 獲得國際大公司的內推機會、串連世界各地菁英：如果流浪是為了找回家的路，我們有責任把回家的路變得更美好
">Previous</a>
    
    
      <a href="/eks-best-practice-load-balancing-2-en/" class="pagination--pager" title="[AWS][EKS] Best practice for load balancing - 2. imbalanced problem
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  

  <!-- Google Adsense -->
  <div class="page__related">
    <h4 class="page__related-title">You May Also Have Interest</h4>
    <div>
        <!-- responsive ad -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-1852752964062281"
             data-ad-slot="2849626059"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>
  </div>

  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/posts/2023/04/five-years-at-amazon-as-cloud-support-engineer-in-aws/cover.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/five-years-at-amazon-as-cloud-support-engineer-in-aws/" rel="permalink">身處 Amazon 工作 5 年學到的事：在 AWS 擔任 Cloud Support Engineer 是什麼樣的體驗
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">2023 是我在 AWS 擔任 Cloud Support Engineer 的第六年，這份工作對我來說某種程度上是又愛又恨。作為見證 AWS 中文技術支援團隊的一員，五年時間說長不長，說短也不短，卻有非常多學習和體悟。
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/posts/2023/03/aws-cloud-support-engineer-interview-tips-and-required-skills/cover.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/aws-cloud-support-engineer-interview-tips-and-required-skills/" rel="permalink">在 AWS Cloud Support Engineer 面試中脫穎而出：必備的技術能力和重要特質
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">如果你正準備面試 AWS Cloud Support Engineer 的職位，在這篇文章中，我將與你分享我對於 AWS Cloud Support Engineer 所需的必備技能和特質，幫助你更好地了解這份職位且思考自己目前所具備的能力是與該團隊所交集，讓你在面試中脫穎而出。
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/eks-aws-load-balancer-controller-v1-to-v2-migration-behavior/" rel="permalink">[AWS] 那些沒寫在文件上的事 - AWS Load Balancer Controller v1 升級至 v2
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">隨著 Amazon EKS 對於 Kubernetes 1.22 的推出，1.21 也預計於 February 15, 2023 在 Amazon EKS 終止支援 1，對於 AWS Load Balancer Controller 仍然使用舊版本的用戶來說，勢必面臨需要升級 AWS Load Balancer ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/posts/2020/10/zero-downtime-deployment-when-using-alb-ingress-controller/deployment-workflow-alb-ingress-controller-4-side-note-of-deregister.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/zero-downtime-deployment-when-using-alb-ingress-controller-on-amazon-eks-and-prevent-502-error/" rel="permalink">[AWS][EKS] Zero downtime deployment(RollingUpdate) when using AWS Load Balancer Controller on Amazon EKS
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  22 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">This article is describing the thing you need to aware when using ALB Ingress Controller (AWS Load Balancer Controller) to do deployment and prevent 502 erro...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->



<div id="footer-subscribe-email-list">
    <h3>Get the updates </h3>
    <form action="https://docs.google.com/forms/d/e/1FAIpQLSfuofCYvu2cV614aDt6SO5ua_5trT0EC5yeSJObLY0KGjFtvQ/formResponse" method="POST">
        <div style="display: flex;">
            <!-- input name="entry.205499253" type="text" id="Name" class="form-control" placeholder="Name" -->
            <input name="entry.1288273007" type="email" id="email" class="form-control" placeholder="Email" required="required" style="margin-top: 2px; margin-right: 5px; width: 50%;">
            <input class="btn btn--primary" id="subscribe" type="submit" value="訂閱 (Sign Up)" style="width: 30%;">
        </div>
    </form>
</div>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8GPCXJPGFZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8GPCXJPGFZ');
</script>
<!-- end custom footer snippets -->

        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
          <li><a href="https://facebook.com/EasonTechTalk" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    <li><a href="/sitemap.xml"><i class="fas fa-fw fa-sitemap" aria-hidden="true"></i> SiteMap</a></li>
    <li><a href="/tags"><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags</a></li>
    <li><a href="https://toolbox.easoncao.com/"><i class="fas fa-fw fa-toolbox" aria-hidden="true"></i> ToolBox</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Continuous Improvement. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-80058083-2']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://easoncao.com/eks-best-practice-load-balancing-1-en/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/eks-best-practice-load-balancing-1-en"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://lenlabs.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  





  </body>
</html>
